<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IPTV+</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #141414;
      color: #ffffff;
      user-select: none;
      margin: 0;
    }

    #grupo-filtros {
      margin: 20px 10px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    #grupo-filtros button,
    .boton-filtro {
      background-color: #333;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
      text-decoration: none;
    }

    #grupo-filtros button:hover,
    .boton-filtro:hover {
      background-color: #e50914;
    }

    #grupo-filtros button.activo {
      background-color: #e50914;
      font-weight: bold;
    }

    #search-container {
      margin: 20px;
    }

    #search-bar {
      width: 100%;
      max-width: 500px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #444;
      background-color: #1e1e1e;
      color: white;
      font-size: 16px;
    }

    #lista {
      max-width: 90%;
      margin: 20px auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      justify-content: center;
    }

    .item {
      cursor: pointer;
      border: 1px solid #444;
      padding: 10px;
      background: #1e1e1e;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.2s;
      outline: none;
    }

    .item:hover,
    .item:focus {
      transform: scale(1.05);
      border-color: #e50914;
    }

    .item img {
      width: 100%;
      height: auto;
      object-fit: cover;
      border-radius: 5px;
    }

    .item span {
      margin-top: 5px;
      font-size: 14px;
      text-align: center;
    }

    /* AHORA SIEMPRE A PANTALLA COMPLETA */
    .fullscreen-video {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      z-index: 9999;
      overflow: hidden;
    }

    .fullscreen-video video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .video-controls {
      position: absolute;
      top: 8px;
      left: 12px;
      right: 12px;
      display: flex;
      justify-content: space-between;
      z-index: 10000;
    }

    .video-controls button {
      font-size: 20px;
      color: white;
      background: rgba(0,0,0,0.5);
      border: none;
      padding: 4px 10px;
      cursor: pointer;
      border-radius: 5px;
    }

    .video-controls button:hover {
      background: rgba(255,255,255,0.2);
    }
  </style>
</head>
<body>

<div id="main-content" style="display: block;">
  <div id="grupo-filtros"></div>

  <div id="search-container">
    <input id="search-bar" type="text" placeholder="Buscar por nombre de canal o video..." oninput="filtrarLista()" />
  </div>

  <div id="lista"></div>

  <div style="margin: 30px 0; text-align: center;">
    <a href="go:SMARTTVP" class="boton-filtro">VERSIÓN SMART TV</a>
  </div>

  <div style="margin: 30px 0; text-align: center;">
    <a href="go:MOVIES" class="boton-filtro">:::MOVIES:::</a>
  </div>

  <div id="fullscreen-video" class="fullscreen-video">
    <div class="video-controls">
      <!-- BOTÓN RETROCEDER -->
      <button onclick="salirFullscreen()">⟵</button>
      <!-- BOTÓN X -->
      <button onclick="cerrarVideo()">×</button>
    </div>
    <video id="video-player" autoplay muted></video>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
  document.addEventListener('keydown', function (event) {
    if (event.key === 'F12') event.preventDefault();
    if ((event.ctrlKey && event.shiftKey && ['I', 'C', 'J'].includes(event.key)) || (event.ctrlKey && event.key === 'u')) {
      event.preventDefault();
    }
  });

  document.addEventListener('contextmenu', function (event) {
    event.preventDefault();
  });

  cargarLista();

  let videoPlayer = document.getElementById("video-player");
  let fullscreenVideo = document.getElementById("fullscreen-video");
  let listaElementos = document.getElementById("lista");
  let listaCanales = [];
  let grupos = new Set();
  let grupoActual = "Todos";

  async function cargarLista() {
    const url = "https://ltvplus.github.io/|>r3M!uM.m3u";
    const response = await fetch(url);
    const data = await response.text();
    const lineas = data.split("\n");

    grupos = new Set(["Todos"]);
    listaCanales = [];

    for (let i = 0; i < lineas.length; i++) {
      if (lineas[i].startsWith("#EXTINF")) {
        const nombre = lineas[i].split(",")[1];
        const logo = (lineas[i].match(/tvg-logo="(.*?)"/) || [])[1];
        const grupo = (lineas[i].match(/group-title="(.*?)"/) || [])[1] || "Otros";
        const urlVideo = lineas[i+1];

        grupos.add(grupo);

        const item = document.createElement("div");
        item.className = "item";
        item.onclick = () => playVideo(urlVideo);

        if (logo) {
          const img = document.createElement("img");
          img.src = logo;
          item.appendChild(img);
        }

        const span = document.createElement("span");
        span.textContent = nombre;
        item.appendChild(span);

        listaCanales.push({ nombre, grupo, item });
      }
    }

    renderGrupos();
    filtrarLista();
  }

  function renderGrupos() {
    const cont = document.getElementById("grupo-filtros");
    cont.innerHTML = "";
    grupos.forEach(g => {
      const b = document.createElement("button");
      b.textContent = g;
      if (g === grupoActual) b.classList.add("activo");
      b.onclick = () => { grupoActual = g; renderGrupos(); filtrarLista(); };
      cont.appendChild(b);
    });
  }

  function filtrarLista() {
    listaElementos.innerHTML = "";
    const f = document.getElementById("search-bar").value.toLowerCase();
    listaCanales.forEach(c => {
      if ((grupoActual === "Todos" || c.grupo === grupoActual) && c.nombre.toLowerCase().includes(f)) {
        listaElementos.appendChild(c.item);
      }
    });
  }

  function playVideo(url) {
    localStorage.setItem("scrollY", window.scrollY);
    fullscreenVideo.style.display = "block";
    fullscreenVideo.requestFullscreen?.();

    if (url.endsWith(".m3u8") && Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(videoPlayer);
    } else {
      videoPlayer.src = url;
    }

    videoPlayer.muted = false;
    videoPlayer.play();
  }

  function salirFullscreen() {
    if (document.fullscreenElement) {
      document.exitFullscreen();
    }
  }

  function cerrarVideo() {
    if (document.fullscreenElement) {
      document.exitFullscreen();
    }
    fullscreenVideo.style.display = "none";
    videoPlayer.pause();
    videoPlayer.src = "";

    const savedY = localStorage.getItem("scrollY");
    if (savedY !== null) {
      window.scrollTo(0, parseInt(savedY));
      localStorage.removeItem("scrollY");
    }
  }
</script>
</body>
</html>
